<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>互動式 GMB Web 3.0 功能比較心智圖 (D3.js)</title>
    <!-- 引入 Tailwind CSS 以進行樣式設計 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 D3.js 函式庫 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap">
    <style>
        /* 基本樣式設定 */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            overflow: hidden; /* 防止頁面滾動 */
        }
        .node circle {
            cursor: pointer;
            stroke-width: 2.5px;
        }
        .node text {
            font-size: 14px;
            paint-order: stroke;
            stroke: #fff;
            stroke-width: 3.5px;
            stroke-linecap: butt;
            stroke-linejoin: miter;
            pointer-events: none; /* 文字不阻擋點擊事件 */
        }
        .link {
            fill: none;
            stroke: #cbd5e1; /* a lighter gray for links */
            stroke-width: 1.5px;
        }
        /* 自訂下拉選單樣式 */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%236B7280%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.4-5.4-13z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right .7rem center;
            background-size: .65em auto;
        }
        /* 搜尋框動畫 */
        .shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            10%, 90% { transform: translateX(-1px); }
            20%, 80% { transform: translateX(2px); }
            30%, 50%, 70% { transform: translateX(-4px); }
            40%, 60% { transform: translateX(4px); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

    <div class="absolute top-0 left-0 p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-br-2xl shadow-lg z-10 max-w-sm">
        <h1 class="text-xl font-bold text-gray-900 dark:text-white">GMB Web 3.0 功能比較</h1>
        <div class="mt-3 flex flex-wrap items-center gap-2">
            <!-- 國家選擇器 -->
            <select id="countryA" class="w-28 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
            <span class="text-gray-500 dark:text-gray-400">vs</span>
            <select id="countryB" class="w-28 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
            <button id="compareBtn" class="px-4 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-sm">比較</button>
        </div>
        <!-- 搜尋框 -->
        <div class="mt-3 relative">
            <input type="text" id="searchInput" list="searchSuggestions" class="w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md pl-3 pr-10 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="搜尋功能...">
            <button id="searchBtn" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                </svg>
            </button>
            <datalist id="searchSuggestions"></datalist>
        </div>
        <!-- 展開/收合/置中 按鈕 -->
        <div class="mt-2 flex items-center gap-2">
            <button id="expandAllBtn" class="px-3 py-1 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 text-xs">全部展開</button>
            <button id="collapseAllBtn" class="px-3 py-1 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 text-xs">全部收合</button>
            <button id="centerBtn" title="回到中心" class="p-1.5 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 4.5a.5.5 0 0 1 .5.5v2h2a.5.5 0 0 1 0 1h-2v2a.5.5 0 0 1-1 0v-2h-2a.5.5 0 0 1 0-1h2v-2a.5.5 0 0 1 .5-.5z"/>
                  <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H2z"/>
                </svg>
            </button>
        </div>
        <!-- 圖例與統計 -->
        <div class="mt-3 grid grid-cols-2 gap-x-4 text-xs">
            <!-- 圖例 -->
            <div id="legend" class="space-y-1">
                <div class="flex items-center"><div class="w-3 h-3 rounded-full mr-2" style="background-color: #4ade80;"></div><span id="legendAandB">兩者皆有</span></div>
                <div class="flex items-center"><div class="w-3 h-3 rounded-full mr-2" style="background-color: #60a5fa;"></div><span id="legendA">僅國家 A</span></div>
                <div class="flex items-center"><div class="w-3 h-3 rounded-full mr-2" style="background-color: #fb923c;"></div><span id="legendB">僅國家 B</span></div>
                <div class="flex items-center"><div class="w-3 h-3 rounded-full mr-2 border border-gray-400" style="background-color: #e5e7eb;"></div>兩者皆無</div>
            </div>
            <!-- 統計 -->
            <div id="stats" class="space-y-1 border-l border-gray-200 dark:border-gray-700 pl-4">
                <h3 class="font-semibold text-gray-800 dark:text-gray-100 mb-1">功能統計</h3>
                <div>總功能數：<span id="totalCount" class="font-bold"></span></div>
                <div><span id="statsCountryA"></span>：<span id="countryACount" class="font-bold"></span></div>
                <div><span id="statsCountryB"></span>：<span id="countryBCount" class="font-bold"></span></div>
            </div>
        </div>
    </div>

    <div id="mindmap-container" class="w-full h-screen"></div>

    <script>
        // **最終且正確的心智圖資料 (105項)**
        const fullMindmapData = {
            "name": "GMB Web 3.0 功能",
            "children": [
                {"name": "存款查詢", "children": [
                    {"name": "交易明細查詢", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "帳戶餘額查詢", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "存款歸戶查詢", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "綜存整合查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "定存存單查詢", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "匯入匯款查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"V", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "外匯收支或交易申報書查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "電子回單", "availability": {"台灣":"X", "大陸":"V", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "外匯水單與還款收據查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "支票影像查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "存款平均餘額查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "國內轉帳", "children": [
                    {"name": "台幣單筆轉帳", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "台幣多筆轉帳", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "台幣預約轉帳", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "預約轉帳查詢/取消", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "常用帳號維護", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "繳費", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "繳稅", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "分戶帳轉帳", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "外匯匯款", "children": [
                    {"name": "外幣匯款", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "預約外幣匯款", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "匯款範本設定", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "受款人資料維護", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "外匯收支或交易申報書管理", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "全球資金管理", "children": [
                    {"name": "單筆付款", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "多筆付款", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "集團帳戶查詢", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "掃碼支付", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "交易授權", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "交易查詢", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "電子回單", "availability": {"台灣":"X", "大陸":"V", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "集團帳戶管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "範本管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "收款人管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "使用者管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "額度管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "操作日誌查詢", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "訊息通知", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "操作員管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "檔案傳輸", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}}
                ]},
                {"name": "貸款服務", "children": [
                    {"name": "貸款本息查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "貸款歸戶查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "動用/還款", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "額度查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "支票服務", "children": [
                    {"name": "空白票據領取", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "票據狀況查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "票據止付", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "託收票據查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "基金", "children": [
                    {"name": "基金投資總覽", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "基金交易明細", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "基金損益報告", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "基金下單", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "基金贖回", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "基金轉換", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "基金預約交易查詢/取消", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "投資屬性評估", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "外國債", "children": [
                    {"name": "外國債投資總覽", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "外國債交易明細", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "外國債配息明細", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "外國債交易", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "外國債預約交易查詢/取消", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "結構型商品", "children": [
                    {"name": "結構型商品投資總覽", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "結構型商品交易明細", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "結構型商品配息明細", "availability": {"台灣":"V", "大陸":"X", "香港":"V", "柬埔寨":"X", "新加坡":"V", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "薪資轉帳", "children": [
                    {"name": "薪資轉帳", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "薪資明細查詢", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "薪資範本維護", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}}
                ]},
                {"name": "廠商付款", "children": [
                    {"name": "廠商付款", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "廠商付款明細查詢", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "廠商付款範本維護", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}}
                ]},
                {"name": "票據/信用狀", "children": [
                    {"name": "進口信用狀", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "出口信用狀", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "票據查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "證券服務", "children": [
                    {"name": "證券帳戶查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "證券交易", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "庫存查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "對帳單查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "複委託", "children": [
                    {"name": "外幣複委託帳戶授權查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "外幣複委託帳號圈存狀態查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "交割專戶額度動支", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "交割專戶當日還款", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "分戶帳授權", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "分戶帳約定轉帳設定", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "期貨", "children": [
                    {"name": "期貨結算業務-台幣", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "期貨結算業務-外幣", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "台幣保證金專戶餘額查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}},
                    {"name": "台幣保證金專戶明細查詢", "availability": {"台灣":"V", "大陸":"X", "香港":"X", "柬埔寨":"X", "新加坡":"X", "越南":"X", "菲律賓":"X", "馬來西亞":"X", "緬甸":"X", "寮國":"X"}}
                ]},
                {"name": "使用者管理", "children": [
                    {"name": "使用者資料維護", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "密碼變更", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "交易權限設定", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "企業授權中心", "children": [
                        {"name": "簡易授權設定", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                        {"name": "台幣約定轉入帳號管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                        {"name": "部門別管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                        {"name": "一年內未登入使用者查詢", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                        {"name": "角色管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                        {"name": "人員管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                        {"name": "交易簽核流程管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                        {"name": "交易套用流程管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                        {"name": "企業參數管理", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                        {"name": "授權進度檢視", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                        {"name": "授權紀錄查詢", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                        {"name": "帳號新增設定", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}}
                    ]}
                ]},
                {"name": "系統設定", "children": [
                    {"name": "通知設定", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "常用功能設定", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}},
                    {"name": "語言與地區設定", "availability": {"台灣":"V", "大陸":"V", "香港":"V", "柬埔寨":"V", "新加坡":"V", "越南":"V", "菲律賓":"V", "馬來西亞":"V", "緬甸":"V", "寮國":"V"}}
                ]}
            ]
        };

        const countries = ["台灣", "大陸", "香港", "柬埔寨", "新加坡", "越南", "菲律賓", "馬來西亞", "緬甸", "寮國"];
        const countryASelect = document.getElementById('countryA');
        const countryBSelect = document.getElementById('countryB');
        const compareBtn = document.getElementById('compareBtn');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const searchSuggestions = document.getElementById('searchSuggestions');
        const expandAllBtn = document.getElementById('expandAllBtn');
        const collapseAllBtn = document.getElementById('collapseAllBtn');
        const centerBtn = document.getElementById('centerBtn');
        
        // 填充國家選項
        countries.forEach(country => {
            countryASelect.innerHTML += `<option value="${country}">${country}</option>`;
            countryBSelect.innerHTML += `<option value="${country}">${country}</option>`;
        });
        countryASelect.value = "台灣";
        countryBSelect.value = "越南";

        // 填充搜尋建議
        const allFunctions = [];
        function getLeafNodes(node) {
            if (node.children) {
                node.children.forEach(getLeafNodes);
            } else if (node.availability) {
                allFunctions.push(node.name);
            }
        }
        fullMindmapData.children.forEach(majorCategory => {
            if (majorCategory.children) {
                majorCategory.children.forEach(getLeafNodes);
            }
        });
        allFunctions.forEach(func => {
            const option = document.createElement('option');
            option.value = func;
            searchSuggestions.appendChild(option);
        });

        const container = document.getElementById('mindmap-container');
        const width = container.clientWidth;
        const height = container.clientHeight;
        let i = 0;

        const zoom = d3.zoom().scaleExtent([0.1, 3]).on("zoom", (event) => {
            g.attr("transform", event.transform);
        });

        const svg = d3.select(container).append("svg")
            .attr("width", width)
            .attr("height", height)
            .call(zoom);
        
        const g = svg.append("g");
        const tree = d3.tree().nodeSize([50, 300]);
        const root = d3.hierarchy(fullMindmapData);
        
        root.x0 = height / 2;
        root.y0 = 0;
        root.descendants().forEach((d, i) => {
            d.id = i;
            d._children = d.children;
            if (d.depth > 0) d.children = null;
        });

        function getNodeColor(d, countryA, countryB) {
            if (!d.data.availability) {
                return d._children ? "#a5b4fc" : "#e2e8f0";
            }
            const availA = d.data.availability[countryA.trim()] === 'V';
            const availB = d.data.availability[countryB.trim()] === 'V';
            if (availA && availB) return "#4ade80";
            if (availA) return "#60a5fa";
            if (availB) return "#fb923c";
            return "#e5e7eb";
        }

        function update(source, countryA, countryB, centerNode = null) {
            const duration = 250;
            const nodes = root.descendants().reverse();
            const links = root.links();

            tree(root);

            const node = g.selectAll("g.node").data(nodes, d => d.id);

            const nodeEnter = node.enter().append("g")
                .attr("class", "node")
                .attr("transform", `translate(${source.y0},${source.x0})`)
                .attr("fill-opacity", 0)
                .attr("stroke-opacity", 0)
                .on("click", (event, d) => {
                    if (d.depth === 0) return;
                    d.children = d.children ? null : d._children;
                    update(d, countryA, countryB);
                });

            nodeEnter.append("circle")
                .attr("r", 10)
                .attr("stroke", d => d.data.availability ? "#9ca3af" : "#6366f1");

            nodeEnter.append("text")
                .attr("x", d => d._children || d.children ? -18 : 18)
                .attr("dy", "0.31em")
                .attr("text-anchor", d => d._children || d.children ? "end" : "start")
                .text(d => d.data.name)
                .style("fill", "#1f2937")
                .clone(true).lower()
                .attr("stroke-linejoin", "round")
                .attr("stroke-width", 3)
                .attr("stroke", "white");

            const nodeUpdate = node.merge(nodeEnter).transition().duration(duration)
                .attr("transform", d => `translate(${d.y},${d.x})`)
                .attr("fill-opacity", 1)
                .attr("stroke-opacity", 1);
            
            nodeUpdate.select('circle')
                .attr("fill", d => getNodeColor(d, countryA, countryB));

            node.exit().transition().duration(duration).remove()
                .attr("transform", `translate(${source.y},${source.x})`)
                .attr("fill-opacity", 0)
                .attr("stroke-opacity", 0);

            const link = g.selectAll("path.link").data(links, d => d.target.id);

            const linkEnter = link.enter().insert("path", "g")
                .attr("class", "link")
                .attr("d", d3.linkHorizontal().x(d => source.y0).y(d => source.x0));

            link.merge(linkEnter).transition().duration(duration)
                .attr("d", d3.linkHorizontal().x(d => d.y).y(d => d.x));

            link.exit().transition().duration(duration).remove()
                .attr("d", d3.linkHorizontal().x(d => source.y).y(d => source.x));

            root.each(d => {
                d.x0 = d.x;
                d.y0 = d.y;
            });
            
            // 如果有指定中心節點，則移動並高亮
            if (centerNode) {
                // 延遲以等待展開動畫完成
                setTimeout(() => {
                    const scale = 1;
                    const x = -centerNode.y * scale + width / 2;
                    const y = -centerNode.x * scale + height / 2;
                    
                    const transform = d3.zoomIdentity.translate(x, y).scale(scale);
                    
                    svg.transition().duration(750).call(zoom.transform, transform);

                    // 高亮顯示
                    g.selectAll(".node")
                        .filter(d => d.id === centerNode.id)
                        .select("circle")
                        .transition().duration(250)
                        .attr("r", 15)
                        .style("stroke", "#ef4444")
                        .transition().duration(750)
                        .attr("r", 10)
                        .style("stroke", d => d.data.availability ? "#9ca3af" : "#6366f1");
                }, duration); // 等待與節點更新相同的時間
            }
        }
        
        function calculateAndDisplayStats(countryA, countryB) {
            let total = 0, countA = 0, countB = 0;
            root.each(d => {
                if (d.data.availability) {
                    total++;
                    if (d.data.availability[countryA.trim()] === 'V') countA++;
                    if (d.data.availability[countryB.trim()] === 'V') countB++;
                }
            });
            document.getElementById('totalCount').textContent = total;
            document.getElementById('statsCountryA').textContent = `${countryA}`;
            document.getElementById('countryACount').textContent = countA;
            document.getElementById('statsCountryB').textContent = `${countryB}`;
            document.getElementById('countryBCount').textContent = countB;
        }

        function handleCompare() {
            const countryA = countryASelect.value;
            const countryB = countryBSelect.value;
            document.getElementById('legendA').textContent = `僅 ${countryA}`;
            document.getElementById('legendB').textContent = `僅 ${countryB}`;
            calculateAndDisplayStats(countryA, countryB);
            update(root, countryA, countryB);
        }

        function handleSearch() {
            const searchTerm = searchInput.value;
            if (!searchTerm) return;

            const countryA = countryASelect.value;
            const countryB = countryBSelect.value;

            let targetNode = null;
            root.each(d => {
                if (d.data.name.toLowerCase() === searchTerm.toLowerCase()) {
                    targetNode = d;
                }
            });

            if (targetNode) {
                // 展開路徑
                let current = targetNode.parent;
                while(current) {
                    if(current._children) {
                        current.children = current._children;
                    }
                    current = current.parent;
                }
                // 呼叫 update 並傳入 targetNode 以進行置中和高亮
                update(root, countryA, countryB, targetNode);

            } else {
                searchInput.classList.add('shake');
                setTimeout(() => searchInput.classList.remove('shake'), 500);
            }
        }
        
        function expandAll() {
            root.each(d => {
                if (d._children) {
                    d.children = d._children;
                    d._children = null;
                }
            });
            handleCompare(); // Re-render with current country selection
        }

        function collapseAll() {
            root.each(d => {
                if (d.depth > 0) { // Keep root expanded
                    if (d.children) {
                        d._children = d.children;
                        d.children = null;
                    }
                }
            });
            handleCompare(); // Re-render with current country selection
        }

        function centerView() {
            const initialTransform = d3.zoomIdentity.translate(width / 4, height / 2).scale(1);
            svg.transition().duration(750).call(zoom.transform, initialTransform);
        }

        compareBtn.addEventListener('click', handleCompare);
        searchBtn.addEventListener('click', handleSearch);
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                handleSearch();
            }
        });
        expandAllBtn.addEventListener('click', expandAll);
        collapseAllBtn.addEventListener('click', collapseAll);
        centerBtn.addEventListener('click', centerView);
        
        // 初始繪製
        handleCompare();
        centerView(); // 將根節點置中
    </script>
</body>
</html>
